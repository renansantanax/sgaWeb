<div class="min-h-screen bg-gradient-to-b from-slate-50 to-white dark:from-slate-950 dark:to-slate-900 text-slate-900 dark:text-slate-100">
  <main class="mx-auto max-w-6xl px-4 sm:px-6 lg:px-8 py-8 space-y-6">

    <!-- Header -->
    <header class="flex flex-col gap-3 md:flex-row md:items-end md:justify-between">
      <div>
        <h1 class="text-3xl md:text-4xl font-black tracking-tight bg-gradient-to-r from-blue-600 via-indigo-600 to-cyan-600 bg-clip-text text-transparent">
          Dashboard de Equipamentos
        </h1>
        <p class="text-sm text-slate-500 dark:text-slate-400 mt-1">
          Visão geral de ativos, status e alocações.
        </p>
      </div>
      <div class="flex gap-2">
        <button routerLink="/equipment/new" class="inline-flex items-center gap-2 px-4 py-2 rounded-xl shadow-sm ring-1 ring-slate-200 dark:ring-slate-800 bg-white/70 dark:bg-slate-900/60 hover:bg-white/90 dark:hover:bg-slate-900 transition">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v12m6-6H6" />
          </svg>
          Adicionar
        </button>
        <button class="inline-flex items-center gap-2 px-4 py-2 rounded-xl shadow-sm ring-1 ring-slate-200 dark:ring-slate-800 bg-white/70 dark:bg-slate-900/60 hover:bg-white/90 dark:hover:bg-slate-900 transition">
          Exportar CSV
        </button>
      </div>
    </header>

    <!-- Alerta de erro -->
    <div *ngIf="errorMessage()" class="rounded-2xl ring-1 ring-red-200/70 dark:ring-red-900/40 bg-red-50/70 dark:bg-red-900/20 text-red-800 dark:text-red-200 p-4">
      {{ errorMessage() }}
      <button class="ml-2 underline hover:no-underline" (click)="fetch()">tentar novamente</button>
    </div>

    <!-- KPIs -->
    <section class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
      <div class="rounded-2xl shadow-sm ring-1 ring-slate-200 dark:ring-slate-800 bg-white/70 dark:bg-slate-900/60 p-5">
        <p class="text-sm text-slate-500 dark:text-slate-400">Total</p>
        <p class="mt-1 text-3xl font-bold">{{ kpiTotal() }}</p>
      </div>
      <div class="rounded-2xl shadow-sm ring-1 ring-slate-200 dark:ring-slate-800 bg-white/70 dark:bg-slate-900/60 p-5">
        <p class="text-sm text-slate-500 dark:text-slate-400">Em uso</p>
        <p class="mt-1 text-3xl font-bold">{{ kpiEmUso() }}</p>
      </div>
      <div class="rounded-2xl shadow-sm ring-1 ring-slate-200 dark:ring-slate-800 bg-white/70 dark:bg-slate-900/60 p-5">
        <p class="text-sm text-slate-500 dark:text-slate-400">Em estoque</p>
        <p class="mt-1 text-3xl font-bold">{{ kpiEstoque() }}</p>
      </div>
      <div class="rounded-2xl shadow-sm ring-1 ring-slate-200 dark:ring-slate-800 bg-white/70 dark:bg-slate-900/60 p-5">
        <p class="text-sm text-slate-500 dark:text-slate-400">Em manutenção</p>
        <p class="mt-1 text-3xl font-bold">{{ kpiManutencao() }}</p>
      </div>
    </section>

    <!-- Filtros -->
    <section class="rounded-2xl shadow-sm ring-1 ring-slate-200 dark:ring-slate-800 bg-white/70 dark:bg-slate-900/60 p-4">
      <div class="grid grid-cols-1 md:grid-cols-4 gap-3">
        <!-- Busca -->
        <div class="md:col-span-2">
          <label class="block text-sm mb-1 text-slate-600 dark:text-slate-300">Buscar</label>
          <div class="relative">
            <svg class="w-5 h-5 text-slate-400 absolute left-3 top-1/2 -translate-y-1/2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
            </svg>
            <input #searchBox (input)="onSearch(searchBox.value)" type="text" placeholder="Modelo, marca, tag, colaborador…" class="w-full pl-10 pr-3 py-2 rounded-xl border border-slate-200 dark:border-slate-800 bg-white/80 dark:bg-slate-950/40 outline-none focus:ring-2 focus:ring-blue-500" />
          </div>
        </div>

        <!-- Status -->
        <div>
          <label class="block text-sm mb-1 text-slate-600 dark:text-slate-300">Status</label>
          <select #statusSel (change)="onChangeStatus(statusSel.value)" class="w-full px-3 py-2 rounded-xl border border-slate-200 dark:border-slate-800 bg-white/80 dark:bg-slate-950/40 outline-none focus:ring-2 focus:ring-blue-500">
            <option value="">Todos</option>
            <option *ngFor="let s of statusList()" [value]="s">{{ s.replace('_',' ') }}</option>
          </select>
        </div>

        <!-- Tipo -->
        <div>
          <label class="block text-sm mb-1 text-slate-600 dark:text-slate-300">Tipo</label>
          <select #tipoSel (change)="onChangeTipo(tipoSel.value)" class="w-full px-3 py-2 rounded-xl border border-slate-200 dark:border-slate-800 bg-white/80 dark:bg-slate-950/40 outline-none focus:ring-2 focus:ring-blue-500">
            <option value="">Todos</option>
            <option *ngFor="let t of tipoList()" [value]="t">{{ t }}</option>
          </select>
        </div>
      </div>
    </section>

    <!-- Loading skeleton -->
    <section *ngIf="isLoading()" class="space-y-3">
      <div class="h-10 rounded-2xl bg-slate-200/70 dark:bg-slate-800 animate-pulse"></div>
      <div class="h-64 rounded-2xl bg-slate-200/70 dark:bg-slate-800 animate-pulse"></div>
    </section>

    <!-- Empty state -->
    <section *ngIf="!isLoading() && total() === 0" class="rounded-2xl ring-1 ring-slate-200 dark:ring-slate-800 bg-white/70 dark:bg-slate-900/60 p-10 text-center">
      <p class="text-lg font-medium">Nenhum equipamento encontrado</p>
      <p class="text-sm text-slate-500 dark:text-slate-400 mt-1">Ajuste os filtros ou adicione novos itens.</p>
    </section>

    <!-- Tabela -->
    <section *ngIf="!isLoading() && total() > 0" class="rounded-2xl overflow-hidden ring-1 ring-slate-200 dark:ring-slate-800 bg-white/80 dark:bg-slate-900/60">
      <div class="overflow-x-auto">
        <table class="min-w-full text-sm">
          <thead class="bg-slate-100/70 dark:bg-slate-800/70 text-slate-700 dark:text-slate-200">
            <tr>
              <th class="px-6 py-3 text-left font-semibold">Tipo</th>
              <th class="px-6 py-3 text-left font-semibold">Modelo / Marca</th>
              <th class="px-6 py-3 text-left font-semibold">Service Tag</th>
              <th class="px-6 py-3 text-left font-semibold">Status</th>
              <th class="px-6 py-3 text-left font-semibold">Colaborador</th>
              <th class="px-6 py-3 text-left font-semibold">Garantia</th>
              <th class="px-6 py-3 text-center font-semibold">Ações</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-slate-100 dark:divide-slate-800">
            <tr *ngFor="let eq of paginated(); trackBy: trackById" class="hover:bg-slate-50/80 dark:hover:bg-slate-800/40 transition">
              <td class="px-6 py-3">{{ eq.tipoEquipamento }}</td>
              <td class="px-6 py-3">{{ eq.modelo }} <span class="text-slate-500">({{ eq.marca }})</span></td>
              <td class="px-6 py-3 font-mono">{{ eq.serviceTag }}</td>
              <td class="px-6 py-3">
                <span class="px-2 py-1 text-xs font-semibold rounded-full" [ngClass]="{
                        'bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-200': eq.statusEquipamento === 'EM_USO',
                        'bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-200': eq.statusEquipamento === 'EM_ESTOQUE',
                        'bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-200': eq.statusEquipamento === 'EM_MANUTENCAO'
                      }">
                  {{ eq.statusEquipamento.replace('_',' ') }}
                </span>
              </td>
              <td class="px-6 py-3">{{ eq.colaborador?.nome || '—' }}</td>
              <td class="px-6 py-3">{{ eq.dataFimGarantia | date:'dd/MM/yyyy' }}</td>
              <td class="px-6 py-3 text-center space-x-3">
                <button class="text-blue-600 hover:underline">Editar</button>
                <button class="text-red-600 hover:underline">Excluir</button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Footer / paginação -->
      <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-3 p-4">
        <div class="text-sm text-slate-600 dark:text-slate-300">
          Exibindo
          {{ ((page()-1) * pageSize()) + 1 }}
          –
          {{ (page()*pageSize() >= total() ? total() : page()*pageSize()) }}
          de {{ total() }}
        </div>

        <div class="flex items-center gap-3">
          <select #sizeSel [value]="pageSize()" (change)="changePageSize(+sizeSel.value)" class="px-2 py-1 rounded-lg border border-slate-200 dark:border-slate-800 bg-white/80 dark:bg-slate-950/40">
            <option [value]="5">5 / pág</option>
            <option [value]="10">10 / pág</option>
            <option [value]="20">20 / pág</option>
          </select>

          <div class="flex items-center gap-2">
            <button (click)="previous()" [disabled]="page() === 1" class="px-3 py-1 rounded-lg border border-slate-200 dark:border-slate-800 disabled:opacity-50">
              Anterior
            </button>
            <button (click)="next()" [disabled]="page()*pageSize() >= total()" class="px-3 py-1 rounded-lg border border-slate-200 dark:border-slate-800 disabled:opacity-50">
              Próximo
            </button>
          </div>
        </div>
      </div>
    </section>

  </main>
</div>